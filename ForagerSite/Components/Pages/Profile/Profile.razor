
@page "/Profile"
@using ForagerSite.Services
@using DataAccess.Models
@using Utilities
@using ForagerSite.Components.Profile
@rendermode InteractiveServer
@inject IUserService userService
@inject UserStateService userStateService
@inject IUserFindService userFindService


<h3>Profile</h3>

<div id="containers" style="display: flex; gap: 20px;">
    <div id="profile-container">

        <ProfilePictureEditor />

        @if (!edit)
        {
            <div id="profile-details-container">
                <p><strong>User Name:</strong> @userVm.userSecurity.UssUsername</p>
                <p><strong>Name:</strong> @userVm.user.UsrName</p>
                <p><strong>Rank:</strong> @userVm.user.UsrExpScore</p>
                <p><strong>Joined:</strong> @userVm.user.UsrJoinedDate.ToString("MMMM dd, yyyy")</p>
                <p><strong>Bio:</strong> @userVm.user.UsrBio</p>
                <p><strong>Country:</strong> @userVm.user.UsrCountry</p>
                <p><strong>State/Province:</strong> @userVm.user.UsrStateorProvince</p>
                <button @onclick="EditProfile">Edit</button>
            </div>
        }
        else
        {
            <div id="edit-profile-container">
                <ProfileDetailsEditor UserVm="userVm"
                                      OnSaved="HandleProfileSaved"
                                      OnCancelled="HandleProfileCancelled" />
            </div>
        }
    </div>
    <ProfileFindsList FindsViewModel="userFindsViewModel" />
    <div id="friends-container">
        <h3>Friends</h3>
        <table>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
@code {

    private UserViewModel userVm { get; set; } = new();
    private UserFindsViewModel userFindsViewModel { get; set; } = new();

    private bool edit;

    protected override async Task OnInitializedAsync()
    {
        userVm = userStateService.CurrentUser;
        userFindsViewModel = await userFindService.GetUserFindsViewModel(userVm.user.UsrId);
        edit = false;
    }

    private void EditProfile()
    {
        edit = true;
    }

    private void HandleProfileSaved()
    {
        edit = false;
    }

    private void HandleProfileCancelled()
    {
        edit = false;
    }


}
